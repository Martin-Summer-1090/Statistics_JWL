<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Statistics - 5&nbsp; What causes what?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./modelling_relationships_using_regression_part_1.html" rel="next">
<link href="./from_limited_data_to_populations.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./what_causes_what.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">What causes what?</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title"><strong>Introduction</strong></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./categorical_data_and_proportions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Categorical Data and Proportions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summarizing_and_communicating_lots_of_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Summarizing and communicating lots of data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./from_limited_data_to_populations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">From limited data to populations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./what_causes_what.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">What causes what?</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelling_relationships_using_regression_part_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modelling relationships: Points, Lines and Scatterplots</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelling_relationships_using_regression_part_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Modelling relationship: Prediction using regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./how_sure_can_we_be.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">How sure can we be about what is going on: Estimates and intervals</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Probability: Quantifying uncertainty and variabilility</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./probability_and_statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Putting probability and statistics together</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./answering_questions_and_claiming_discoveries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Answering questions and claiming discoveries</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#correlation-does-not-imply-causation" id="toc-correlation-does-not-imply-causation" class="nav-link active" data-scroll-target="#correlation-does-not-imply-causation"><span class="header-section-number">5.1</span> Correlation does not imply causation</a></li>
  <li><a href="#what-does-it-mean-that-a-variable-is-causal" id="toc-what-does-it-mean-that-a-variable-is-causal" class="nav-link" data-scroll-target="#what-does-it-mean-that-a-variable-is-causal"><span class="header-section-number">5.2</span> What does it mean that a variable is “causal”?</a></li>
  <li><a href="#controlled-experiments" id="toc-controlled-experiments" class="nav-link" data-scroll-target="#controlled-experiments"><span class="header-section-number">5.3</span> Controlled experiments</a>
  <ul class="collapse">
  <li><a href="#field-trials-for-early-polio-vaccines-in-the-us-in-the-1950ies" id="toc-field-trials-for-early-polio-vaccines-in-the-us-in-the-1950ies" class="nav-link" data-scroll-target="#field-trials-for-early-polio-vaccines-in-the-us-in-the-1950ies"><span class="header-section-number">5.3.1</span> Field trials for early polio vaccines in the US in the 1950ies</a></li>
  <li><a href="#school-subsidies-for-the-poor-the-mexican-progresa-poverty-program" id="toc-school-subsidies-for-the-poor-the-mexican-progresa-poverty-program" class="nav-link" data-scroll-target="#school-subsidies-for-the-poor-the-mexican-progresa-poverty-program"><span class="header-section-number">5.3.2</span> School subsidies for the poor: The Mexican progresa poverty program</a></li>
  </ul></li>
  <li><a href="#observational-studies" id="toc-observational-studies" class="nav-link" data-scroll-target="#observational-studies"><span class="header-section-number">5.4</span> Observational studies</a></li>
  <li><a href="#can-we-ever-conclude-causation-from-observational-data" id="toc-can-we-ever-conclude-causation-from-observational-data" class="nav-link" data-scroll-target="#can-we-ever-conclude-causation-from-observational-data"><span class="header-section-number">5.5</span> Can we ever conclude causation from observational data ?</a></li>
  <li><a href="#tabulating-and-analyzing-data-from-a-controlled-randomized-trial-in-r" id="toc-tabulating-and-analyzing-data-from-a-controlled-randomized-trial-in-r" class="nav-link" data-scroll-target="#tabulating-and-analyzing-data-from-a-controlled-randomized-trial-in-r"><span class="header-section-number">5.6</span> Tabulating and analyzing data from a controlled randomized trial in R</a>
  <ul class="collapse">
  <li><a href="#the-factor-class" id="toc-the-factor-class" class="nav-link" data-scroll-target="#the-factor-class"><span class="header-section-number">5.6.1</span> The factor class</a></li>
  <li><a href="#the-tapply-function" id="toc-the-tapply-function" class="nav-link" data-scroll-target="#the-tapply-function"><span class="header-section-number">5.6.2</span> The tapply function</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">5.7</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#exercises-1" id="toc-exercises-1" class="nav-link" data-scroll-target="#exercises-1"><span class="header-section-number">5.7.1</span> Exercises</a></li>
  <li><a href="#exercises-r" id="toc-exercises-r" class="nav-link" data-scroll-target="#exercises-r"><span class="header-section-number">5.7.2</span> Exercises R</a></li>
  </ul></li>
  <li><a href="#project-people-count-the-present-and-future-of-humanity-in-pictures-and-numbers" id="toc-project-people-count-the-present-and-future-of-humanity-in-pictures-and-numbers" class="nav-link" data-scroll-target="#project-people-count-the-present-and-future-of-humanity-in-pictures-and-numbers"><span class="header-section-number">5.8</span> Project People count: The present and future of humanity in pictures and numbers</a>
  <ul class="collapse">
  <li><a href="#age-percentiles-in-kenya-the-united-states-and-japan" id="toc-age-percentiles-in-kenya-the-united-states-and-japan" class="nav-link" data-scroll-target="#age-percentiles-in-kenya-the-united-states-and-japan"><span class="header-section-number">5.8.1</span> Age percentiles in Kenya, the United States and Japan</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">What causes what?</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Overview
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this lecture we discuss what causation means in a statistical sense and why we need be careful to distinguish between causation and correlation. This is a conceptually difficult topic. It is, however, not technically difficult but it will need lots of examples. Fortunately there are many good (and bad) real world examples that I hope will stick with you as reference examples after the course. At the end of this lecture you should understand the idea of randomized trials and observational studies as well as the general ideas of comparison in statistical analysis.</p>
<ol type="1">
<li><p>Causation in a statistical sense means that when we intervene, the chances of different outcomes vary systematically.</p></li>
<li><p>Causation is difficult to establish statistically, but well designed randomized trials are the best available framework.</p></li>
<li><p>You will learn about the principles that helped clinical trials to identify effects and how you can transfer these principles to other fields.</p></li>
<li><p>Observational data may have background factors influencing the apparent relationships between exposure and outcome which may be either observed confounders or lurking factors.</p></li>
<li><p>Statistical methods do not suspend judgment which is always required for the confidence with which causation can be claimed.</p></li>
</ol>
</div>
</div>
<p>The last two centuries brought enormous advances in the expansion of education around the world. Quantitative measures such as literacy rates, school enrollment, the share of education spending in GDP all point into the same direction: While access to education had been the privilege of a very small elite throughout history, things have changed in the direction of a very broad participation.</p>
<p>This is a result of both economic necessities of modern production as well as of political struggles for human rights and equality. Today education is perceived as a right and it is seen as a government duty to provide broad access to basic education. A certain amount of schooling is even compulsory in most countries, although not all the countries have the capacity to broadly enforce such obligations.</p>
<div class="page-columns page-full"><p>Despite all of these developments and efforts in the expansion of education there are still about 8 % of children worldwide which are not in school. Also progress has been heterogeneous across the globe, with literacy rates among the youth of sub Saharan Africa - for example - still below 50 %.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p><div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;Data on this particular topic and an interesting analysis can be found in <span class="citation" data-cites="Roser2021">Roser (<a href="references.html#ref-Roser2021" role="doc-biblioref">2021</a>)</span> at https://ourworldindata.org/children-not-in-school</p></li></div></div>
<p>Education policies have thus been widely debated in international policy circles and have spurred debates as well as to seemingly unresolvable controversies about what is needed to further improve education for those who are still behind and precisely which policies would and would not work towards this goal.</p>
<p>For example, the majority view in international policy circles has been that the focus of education policy should be to get children into the class room and provide the necessary teachers. This entails policies to make sure that children have access to a school nearby as well as the free provision of basic education. Once this is assured, according to this approach, the rest will more or less follow automatically.</p>
<p>But enrollment does not automatically mean that all the children enrolled actually attend. For example, we know from the DHS, the demographic and health survey you learned about in previous lectures, that there is a gap between enrollment and attendance in the countries that have the most urgent need for improved education policies. From the surveys we also know that the absence is not necessarily driven by the fact that the children are needed at home.</p>
<p>Look at this graph compiled from DHS data provided by Our World in Data:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(JWL)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(enrol_attend_dat<span class="sc">$</span>Enrolment, enrol_attend_dat<span class="sc">$</span>Attendance, </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> (<span class="st">"Enrollment versus Attendance"</span>), <span class="at">xlab =</span> (<span class="st">"Enrollment rate primary school"</span>), <span class="at">ylab =</span> (<span class="st">"Attendance rate primary school"</span>), <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">1</span>,<span class="dv">1</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="what_causes_what_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In the graph you see the enrolment rate in primary school at the x-axes and the attendance rate on the y-axes. Such a graph, showing the relation between two variables is called a <strong>scatter plot</strong>. We will learn about the details of scatter plots later in the course.</p>
<p>To understand the graph, think of each point as measuring the enrollment rate in primary school and the attendance rate in primary school in a given year for a given country. Taking many countries around the globe gives you a scatter of such points all showing different enrollment attendance pairs. The whole cloud of points shows a positive slope suggesting that attendance varies positively with enrollment.</p>
<p>To help you interpret the scatter plot think of the following situation: If all children who are enrolled would also attend all the points would be on the blue line, showing all the points where the enrollment rate is equal to the attendance rate. In the data you see many observations where the attendance rate is below the enrolment rate and these observations are quite heterogeneous.</p>
<div class="page-columns page-full"><p>Another aspect that was debated is that enrollment does not necessarily mean that children actually learn something or that they learn at a sufficient quality. This problem of poor learning outcomes in many parts of the globe was demonstrated in many cases.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p><div class="no-row-height column-margin column-container"><li id="fn2"><p><sup>2</sup>&nbsp;For details on the evidence you can for instance look at chapter 4 in the excellent book by <span class="citation" data-cites="BanerjeeDuflo2012">Banerjee and Duflo (<a href="references.html#ref-BanerjeeDuflo2012" role="doc-biblioref">2012</a>)</span></p></li></div></div>
<p>Does this mean these policies are wrong, as their critics claim? They point out that there is no point in all this educational supply if there is no demand for it, taking lack of attendance and lack of sufficient learning outcomes as evidence. If there were demand, these critics argue, supply would follow and the demand arises by itself as soon as there are high enough returns to education.</p>
<p>Why can’t controversies like these not simply be resolved by looking at the data?</p>
<section id="correlation-does-not-imply-causation" class="level2 page-columns page-full" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="correlation-does-not-imply-causation"><span class="header-section-number">5.1</span> Correlation does not imply causation</h2>
<p>Many data sources we have, just rely on education policy outcomes somebody has observed and recorded, so called <strong>observational studies</strong>. For instance, there is a large literature, mainly from before the mid 1990ies in education research, which tried to answer the following question: Do increased financial resources for public schools improve educational outcomes as measured by standard education achievement tests?</p>
<p>A look across countries would - for instance - give the following picture.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(expenditure_outcome_dat<span class="sc">$</span>Expenditure, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>     expenditure_outcome_dat<span class="sc">$</span>Outcome, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> (<span class="st">"Average learning outcomes by total education expenditure per capita"</span>), </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> (<span class="st">"Public and private per capita expenditure on education (PPP, constant 2011-intl $)"</span>), </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> (<span class="st">"Average harmonized learning outcome in 2005 - 2015"</span>), <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">500</span>, <span class="dv">3500</span>, <span class="at">by =</span> <span class="dv">500</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="what_causes_what_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Indeed a study by <span class="citation" data-cites="Hedgesetal1994">Larry Hedges (<a href="references.html#ref-Hedgesetal1994" role="doc-biblioref">1994</a>)</span> confirmed patterns like these. There is strong evidence that education spending and educational outcomes are <strong>positively correlated</strong>. This is the statistics jargon for saying that the variables covary positively. We will learn in detain about correlation in the next chapter.</p>
<p>But does this evidence support the conclusion that there is a causal relation between increased educational spending and student outcomes? There is a straightforward reason why this can not be the case.</p>
<div class="page-columns page-full"><p>We compare very different students or schools across countries in the scatter plot we produced before. In the study by <span class="citation" data-cites="Hedgesetal1994">Larry Hedges (<a href="references.html#ref-Hedgesetal1994" role="doc-biblioref">1994</a>)</span> the variables that were related were students from different households across different schools. In the plot we show here it is students from different households across different countries. For the general point we want to make here, this is immaterial. What matters is that simply comparing outcomes of students across countries or students across schools with different levels of spending does not tell us whether the different spending levels are causal for the variation in outcomes we observe. There may be many other differences between countries and students that are shaping this relationship.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p><div class="no-row-height column-margin column-container"><li id="fn3"><p><sup>3</sup>&nbsp;There are whole websites documenting examples where two variables are highly correlated but it is obvious that there can not be a causal relation. These examples are quite funny. One site you can find for example here: https://tylervigen.com/spurious-correlations Try it out!</p></li></div></div>
<p>Statisticians have summarized this observation in the mantra that <strong>“correlation does not imply causation”</strong>. If we want to establish a causal relation from data we need to work harder.</p>
</section>
<section id="what-does-it-mean-that-a-variable-is-causal" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="what-does-it-mean-that-a-variable-is-causal"><span class="header-section-number">5.2</span> What does it mean that a variable is “causal”?</h2>
<p>When you ask a doctor today about the risks of smoking, he will usually give you a warning and advise against it. One of the arguments will be that the evidence shows that smoking causes lung cancer.</p>
<p>But assume you have been a smoker and now come into the unfortunate situation that you are diagnosed with lung cancer. How do you know that your lung cancer occurred, because you were smoking and you would not have got lung cancer anyway, perhaps for an entirely different reason?</p>
<p>It took the medical profession decades to accept the causality of smoking of lung cancer. The many studies that were undertaken on this subject since the 1930es usually compared people who smoke with non-smokers and tried to take conclusions about the effect from this comparison. In this comparisons the smokers came out badly, showing among many other things higher incidence of lung cancer. So many studies together established a strong correlation between smoking and lung cancer. If smoking cause lung cancer, this would be an explanation of the association between smoking and lung cancer. But this evidence is only circumstantial. There could be some hidden factor - so called <strong>confounding factor</strong> - which makes people smoke and also makes them get lung cancer. In this case there would be no point in quitting smoking.</p>
<p>The famous statistician Sir R.A. Fisher doubted the causal role of cigarettes for lung cancer and suggested possible confounding factors. Epidemiologists conducted careful studies that accumulated evidence that these confounding factors were not plausible. Over time the evidence taken together convinced the medical community that smoking is indeed causal for lung cancer. But causal here has a meaning that takes into account the unavoidable variability that underlies real life.</p>
<p>The statistical notion of causation or causality is not deterministic. If statisticians say there is evidence that smoking is causal for lung cancer it does not mean that every smoker will end up with lung cancer. It does also not mean that lung cancer can occur only if you are a smoker. It rather means that among the group of smokers lung cancer will occur more often. Thus we can not use statistical methods to establish causation in a specific case. The only thing we can possibly establish by data is that smoking increases the proportion of times lung cancer will occur in a population.</p>
<p>This has two important consequences for what needs to be done if we want to find out what causes what. We need to intervene, that is consciously change a variable, and perform experiments. But since we are in a situation of uncertainty we need to intervene more than once, to establish strong enough evidence.</p>
<p>For this reason much of research in medicine and epidemiology today relies on evidence gained from so called controlled experiments. Let us explain next what the ideas behind such an approach is. These ideas have also been extended to other fields, like the research on what works in policies attempting to improve education and to other fields.</p>
</section>
<section id="controlled-experiments" class="level2 page-columns page-full" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="controlled-experiments"><span class="header-section-number">5.3</span> Controlled experiments</h2>
<section id="field-trials-for-early-polio-vaccines-in-the-us-in-the-1950ies" class="level3 page-columns page-full" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="field-trials-for-early-polio-vaccines-in-the-us-in-the-1950ies"><span class="header-section-number">5.3.1</span> Field trials for early polio vaccines in the US in the 1950ies</h3>
<div class="page-columns page-full"><p>Let us take an example from medicine first. Suppose a new drug is found and we would like to introduce it as a medication that can be prescribed by doctors to their patients.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p><div class="no-row-height column-margin column-container"><li id="fn4"><p><sup>4</sup>&nbsp;This discussion follows <span class="citation" data-cites="FrePisPur2009">Freedman, Pisani, and Purves (<a href="references.html#ref-FrePisPur2009" role="doc-biblioref">2009</a>)</span></p></li></div></div>
<p>The basic idea of testing the effectiveness of the medicine is <strong>comparison</strong>. An experiment is designed in which the medicine is given to a <strong>treatment group</strong>. But there are other subjects that are not treated and form another group, the <strong>control group</strong>. Then the responses of the two groups are compared. The assignment of subjects to both groups should be <strong>random</strong> and the experiment should be run <strong>double blind</strong>: Neither the subjects nor the researchers who measure the response should know who was in the control group.</p>
<p>The key of randomization in this protocol is that it keeps the two groups equal except for the treatment. Then, if you measure different outcomes you can conclude with some confidence that the observed difference must be the result of the treatment. This would then establish causality.</p>
<p>One of the first epidemiological studies implementing these ideas was a randomized controlled experiment to show the effectiveness of a vaccine against polio in the US in 1954 . It was conducted by the Public Health Service and the National Foundation for Infantile Paralysis (NFPI).</p>
<p>The field trial was conducted in select school districts throughout the country where the risk of polio was high. Two million children were involved and half a million were vaccinated. A million were deliberately left unvaccinated as controls, half a million refused vaccination.</p>
<p>Children could, however, only be vaccinated with their parents consent, so only children whose parents agreed to the vaccination could go into the treatment group. Parents with higher income were more likely to consent to treatment. This biases the design against the vaccine, since polio is a disease of hygiene. Children in more hygienic surroundings have less exposure to mild cases of polio in early childhood. This prevents the generation of antibodies which protect them against severe infections at a later age.</p>
<p>Many experts recognized the flaw in the design. The assignment to treatment and control was not random and thus the treatment and control group were systematically different. The idea, however, is that both groups should be as similar as possible except for treatment. If the two groups differ to some factor other than treatment this factor my <strong>confound</strong> or get mixed up with the effect of treatment.</p>
<p>To exclude the bias in assignment introduced by parental consent in the NFPI design, it was suggested that the control group has to chosen from the same population as the treatment group using an impartial chance procedure. Such an approach is called <strong>randomized controlled</strong>.</p>
<p>The idea of double blindness was also already used in a new improved design. The children in the control group were given an injection of salt dissolved in water rather than the vaccine, a so called <strong>placebo</strong>. During the experiment therefore the subjects did not know whether they were in the control group or in the treatment group. Also the doctors were not told which group the child belonged to and neither knew those who evaluated the responses.</p>
<p>A subsequent program evaluation published in a scientific journal (<span class="citation" data-cites="Francis1955">Francis (<a href="references.html#ref-Francis1955" role="doc-biblioref">1955</a>)</span>), showed the bias in the NFPI study in comparison with the randomized controlled double blind experiment:</p>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>RCT <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Group =</span> <span class="fu">c</span>(<span class="st">"Treatment"</span>, <span class="st">"Control"</span>, <span class="st">"No consent"</span>), <span class="at">Size =</span> <span class="fu">c</span>(<span class="dv">200000</span>, <span class="dv">200000</span>, <span class="dv">350000</span>), <span class="at">Rate =</span> <span class="fu">c</span>(<span class="dv">28</span>, <span class="dv">71</span>, <span class="dv">46</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>NFIP <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Group =</span> <span class="fu">c</span>(<span class="st">"Grade 2 (vaccine)"</span>, <span class="st">"Grades 1 and 2 (control)"</span>, <span class="st">"Grade 2 (no consent)"</span>), <span class="at">Size =</span> <span class="fu">c</span>(<span class="dv">225000</span>, <span class="dv">725000</span>, <span class="dv">125000</span>), <span class="at">Rate =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">54</span>, <span class="dv">44</span>))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># table on the left</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(RCT)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># table on the right</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(NFIP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-salk-vaccine-field-trials" class="cell tbl-parent quarto-layout-panel anchored">
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-salk-vaccine-field-trials-1" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-salk-vaccine-field-trials" style="flex-basis: 50.0%;justify-content: center;">
<table class="table table-sm table-striped small">
<caption>(a) Randomized Trial</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Group</th>
<th style="text-align: right;">Size</th>
<th style="text-align: right;">Rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Treatment</td>
<td style="text-align: right;">200000</td>
<td style="text-align: right;">28</td>
</tr>
<tr class="even">
<td style="text-align: left;">Control</td>
<td style="text-align: right;">200000</td>
<td style="text-align: right;">71</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No consent</td>
<td style="text-align: right;">350000</td>
<td style="text-align: right;">46</td>
</tr>
</tbody>
</table>
</div>
<div id="tbl-salk-vaccine-field-trials-2" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-salk-vaccine-field-trials" style="flex-basis: 50.0%;justify-content: center;">
<table class="table table-sm table-striped small">
<caption>(b) NFPI study</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Group</th>
<th style="text-align: right;">Size</th>
<th style="text-align: right;">Rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Grade 2 (vaccine)</td>
<td style="text-align: right;">225000</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: left;">Grades 1 and 2 (control)</td>
<td style="text-align: right;">725000</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Grade 2 (no consent)</td>
<td style="text-align: right;">125000</td>
<td style="text-align: right;">44</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="panel-caption table-caption">
<p>Table&nbsp;5.1: Results of the 1954 polio vaccine trials</p>
</div>
</div>
</div>
<p>The two tables show the results of the randomized trial design with the NFPI design. The size of groups and the rates of polio cases per 100.000 in each group are shown in the columns Size and Rate.</p>
<p>In the randomized controlled trial the vaccination cut the polio rate from 71 to 28 per hundred thousand. The NFPI study - by contrast - shows a reduction from 54 to 25 per hundred thousand. The source of the bias which accounts for the difference was confounding. The NFPI treatment group contained only only children whose parents consented to the vaccination. However the control group contained also children whose parents would not have consented. Therefore control and treatment group were not comparable.</p>
</section>
<section id="school-subsidies-for-the-poor-the-mexican-progresa-poverty-program" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="school-subsidies-for-the-poor-the-mexican-progresa-poverty-program"><span class="header-section-number">5.3.2</span> School subsidies for the poor: The Mexican progresa poverty program</h3>
<p>While randomized controlled trials have their origin in medical research and epidemiology, this is an approach that can be applied in other contexts to establish a causal effect. In such fortunate cases, it is possible to produce actual evidence that a certain policy works or not.</p>
<p>As an example consider an education policy program for the poor designed in Mexico in the 1990 called Progresa. The problem Progresa tried to address was how a reasonable support program could be designed to increase school enrollment among the poor.</p>
<p>It was known that school enrollment among the poor was low and that one reason for this low enrollment was that children needed to work to help supporting their families rather than going to school. This situation could be characterized as a kind of poverty trap because the income of the poor families is so low that they cannot afford to enroll the children in school which prevents them to get enough training and eventually higher incomes which can raise them out of poverty.</p>
<p>The Finance minister at that time, Santiago Levy, initiated a program trying to address this problem by designing education grants to poor mothers to support the increase of school enrollment of their children. The Progresa program tried to avoid some known problems of past poverty alleviation programs. If a transfer conditions on current income, this can for instance create an incentive against taking up a job. This can happen because if a recipient of the transfer joins the paid labor force the transfer is lost as earnings increase. This can lead to disincentives to attempts of joining the paid labor force.</p>
<p>The Progresa Program therefore tried to minimize disincentives to work by not conditioning the transfer on current income but only on an initial assessment of household poverty information. This approach was tried as an alternative to build more schools and augment other educational resources such as teachers and teaching quality. While there was evidence that this approach would increase enrollment it was known that such supply policies were not effective for increasing enrollment amongt the poor. So Santiago Levy took a household demand approach providing subsidies which can administratively be targeted to the poor and thereby perhaps help increase the enrollment rates in these groups. But would this work?</p>
<p>To find out the ministry of Finance conducted a randomized controlled trial on a set of villages, selecting some of them at random for receiving Progresa benefits. To provide additional incentives for child enrollment the transfers were conditioned on whether children attended school regularly and the family used preventive health care. More money was given to children in secondary school than to children in primary school to compensate for lost wages (from going to school rather than taking up paid work) and also more money was given for enroling girls than for enroling boys.</p>
<p>Through the selection of all potentially eligible households based on geographical and household poverty information all of these households share similar characteristics. The random allocation of Progresa recipients splits this population into a treatment group (the Progresa recipients) and a control group ( the households which did not receive Progresa transfers). If the groups are then compared with respect to enrollment rates we can say that they are similar in all dimensions except treatment. Differences in enrollment rates between the groups can then be understood as causally linked to the treatment. There is no confounding. This is the basic idea of a randomized controlled trial.</p>
<p>It could indeed be established that Progresa worked to increase school enrollment among the poor in Mexico. Here are the numbers: For boys the enrollment increased from 73 % in the control group to 77 % in the Progresa group. For girls the increase was even bigger, from 67 % in the control group to 75 % in the Progresa group.</p>
<p>The evidence for the success of the Progresa Program also helped that the program survived when political power was transferred to a new government in the next election. Although Santiago Levy was not prime minister any more, the new government continued the program under the new name Oppordunitades.</p>
</section>
</section>
<section id="observational-studies" class="level2 page-columns page-full" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="observational-studies"><span class="header-section-number">5.4</span> Observational studies</h2>
<p>Controlled experiments are different from <strong>observational</strong> studies. In a controlled experiment the investigator decides who will be in the treatment group and who will be in the control group. In an observational study, by contrast, the investigator can just observe what happens and he has no control over assigning subjects to different groups. In an observational study the subjects assign themselves to treatment and control.</p>
<p>This terminology can be confusing because it uses the word control in two meanings: On the one hand, as we discussed in the previous sections a control is a subject who did not get the treatment. A controlled experiment is a study where the investigator decides who will be in the treatment group and who will be in the control group.</p>
<p>Going back to studies on the effects of smoking, which we discussed earlier in this lecture, we can see that such studies must necessarily be observational. We can not make some people smoke for a decade or more just to fulfill a statistically satisfactory research design.</p>
<p>Note, however, that the basic idea of treatment and control groups is still used. The statistician in an observational study on the effects of smoking would compare the smokers - the treatment group with exposure to smoking - with the non-smokers, the control group. The idea is that we can learn something about the effects from smoking by such a comparison.</p>
<p>In this comparison, in the many observational studies that have been done on smoking since the early 20th century, smokers come out pretty badly. They suffer more frequently than non-smokers from heart attacks, lung cancer and other diseases. If smoking would cause these higher rates, this would explain the correlation observed in the data of the observational studies.</p>
<p>However, observing this association, is incomplete as a proof for causation. There might be a hidden factor, not included in the observational study, which makes people smoke and at the same time makes people ill.&nbsp;Such hidden factors are called <strong>confounding factors</strong> or <strong>confounders</strong> in the technical jargon of statisticians.</p>
<p>To think about potential problems of confounding, it is helpful to ask yourselve how the controls were selected. The question is whether the control group is really similar to the treatment group apart from the exposure of interest. If there is confounding something has to be done to deal with it. Statisticians often talk about controlling for confounding factors in an observational study. This is yet another, a third sense in which the word control is used in statistics.</p>
<p>The meaning of the term control in this case is that in the case where subjects differ among themselves in an observational study in crucial ways beside treatment, the statistician adjusts the sample by comparing smaller and more homogemous groups.</p>
<div class="page-columns page-full"><p>A famous example illustrating this point and featured in many textbooks<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> is an observational study on sex bias in admission to graduate studies at the University of California in Berkeley in the 1975. During the study period, 8442 men and 4321 women applied for admission to graduate school. The acceptance rate among men was 44 % and that of women 35 %.</p><div class="no-row-height column-margin column-container"><li id="fn5"><p><sup>5</sup>&nbsp;I follow here the discussion in the textbook by <span class="citation" data-cites="FrePisPur2009">Freedman, Pisani, and Purves (<a href="references.html#ref-FrePisPur2009" role="doc-biblioref">2009</a>)</span> pp.&nbsp;18-19</p></li></div></div>
<p>Assuming that men and women overall were equally well qualified this difference in the admission rate looks like evidence of a different treatment of men and women.</p>
<p>Since each subject did its own admission to graduate studies, the university should have been able to identify the subjects which discriminated against women. But at that point a puzzle appeared. If subjects were looked at seperately subject by subject there didn’t seem to be any bias against women.If there was a bias it was a bias against men. How is this possible?</p>
<p>Over a hundred subjects were involved. However, the six largest together accounted for over one-third of the total number of applicants. The pattern for these subjects was typical of the whole campus.</p>
<p>These are the data for men:</p>
<table class="table-striped table-hover table">
<caption>Admissions data for men graduate programs in the six largest subjects at University of California, Berkeley</caption>
<thead>
<tr class="header">
<th>Subject</th>
<th>Number of Applicants</th>
<th>Percent admitted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>825</td>
<td>62</td>
</tr>
<tr class="even">
<td>B</td>
<td>560</td>
<td>63</td>
</tr>
<tr class="odd">
<td>C</td>
<td>325</td>
<td>37</td>
</tr>
<tr class="even">
<td>D</td>
<td>417</td>
<td>33</td>
</tr>
<tr class="odd">
<td>E</td>
<td>191</td>
<td>28</td>
</tr>
<tr class="even">
<td>F</td>
<td>373</td>
<td>6</td>
</tr>
</tbody>
</table>
<p>And these are the data for women:</p>
<table class="table-striped table-hover table">
<caption>Admissions data for women graduate programs in the six largest subjects at University of California, Berkeley</caption>
<thead>
<tr class="header">
<th>Subject</th>
<th>Number of Applicants</th>
<th>Percent admitted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>108</td>
<td>82</td>
</tr>
<tr class="even">
<td>B</td>
<td>25</td>
<td>68</td>
</tr>
<tr class="odd">
<td>C</td>
<td>593</td>
<td>34</td>
</tr>
<tr class="even">
<td>D</td>
<td>375</td>
<td>35</td>
</tr>
<tr class="odd">
<td>E</td>
<td>393</td>
<td>24</td>
</tr>
<tr class="even">
<td>F</td>
<td>341</td>
<td>7</td>
</tr>
</tbody>
</table>
<p>In each subject, the percentage of female applicants who were admitted is roughly equal to the percentage of male applicants. Subject A is an exception. It appears to discriminate against men because it admitted 82 % of the women and only 62 % of the men. The subject that looks most biased against women is E. But the difference here is only 4 percentage points. When we take all six subjects together they admitted 44% of the male applicants and only 30 % of the females. The difference amounts to 14 percentage points.</p>
<p>There is, however an explanation for this seemingly paradox situation. The first two subjects A and B were easy to get into. Over 50% of men applied to these two subjects. The other four were much harder to get into. Over 90% of the women applied to these subjects.</p>
<p>This means that men applied to the easy subjects whereas women applied for the hard ones. there was a confounding effect. The effect due to the choice of subject was confounded with the effect due to sex. When the choice of the subject is controlled for there is little difference between admission rates of men and women.</p>
<p>This is known as <strong>Simpson’s paradox</strong> which occurs when the apparent direction of an association is reversed by adjusting for a confounding factor.</p>
</section>
<section id="can-we-ever-conclude-causation-from-observational-data" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="can-we-ever-conclude-causation-from-observational-data"><span class="header-section-number">5.5</span> Can we ever conclude causation from observational data ?</h2>
<p><span class="citation" data-cites="Spi2019">Spiegelhalter (<a href="references.html#ref-Spi2019" role="doc-biblioref">2019</a>)</span> discusses a list of criteria first suggested by the British applied statistician Austin Bradford Hill in 1965. These criteria should be considered before concluding that an observed link between an outcome and an exposure was causal. These criteria were much debated and we show here a version of the list presented in <span class="citation" data-cites="Spi2019">Spiegelhalter (<a href="references.html#ref-Spi2019" role="doc-biblioref">2019</a>)</span> and which is due to Jermey Howick - a clinical epidemiologist form the University of Oxford in the UK - and his colleagues.</p>
<p>These criteria are separated in three categories: Direct, mechanistic and parallel evidence. I reproduce the list from the book of <span class="citation" data-cites="Spi2019">Spiegelhalter (<a href="references.html#ref-Spi2019" role="doc-biblioref">2019</a>)</span> here:</p>
<ul>
<li>Direct evidence
<ul>
<li>The size of the effect is so large that it can not be explained by plausible confounding.</li>
<li>There is an appropriate temporal and/or spatial proximity, in that cause precedes effect and effect occurs after a plausible interval and/or cause occurs at the same site as the effect.</li>
<li>The effect increases as the exposure increases and the effect reduces upon reduction in exposure (dose responsiveness and reversibility).</li>
</ul></li>
<li>Mechanistic evidence
<ul>
<li>There is a plausible mechanism of action which could be biological, chemical or mechanical with external evidence for a causal chain.</li>
</ul></li>
<li>Parallel evidence
<ul>
<li>The effect fits with what is known already</li>
<li>The effect is also found when the study is replicated</li>
<li>The effect is found in similar, but not identical studies.</li>
</ul></li>
</ul>
<p>The appropriate handling of causation is still a contested field of statistics. There are various techniques that are based on the idea to use certain techniques to bring an observational study as close as possible to the situation of a randomized controlled experiment. All these techniques adjust in more or less sophisticated ways for potential confounders. Most of these techniques are based on regression, a topic we study later in this course. Whatever sophisticated technique is used judgement is always required if causation is claimed.</p>
</section>
<section id="tabulating-and-analyzing-data-from-a-controlled-randomized-trial-in-r" class="level2 page-columns page-full" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="tabulating-and-analyzing-data-from-a-controlled-randomized-trial-in-r"><span class="header-section-number">5.6</span> Tabulating and analyzing data from a controlled randomized trial in R</h2>
<p>In this section we discussed examples of randomized controlled experiments and observational studies to explain key ideas of examining data and in particular how to compare treatment and control groups.</p>
<p>In terms of R this gives us an opportunity to learn in this context about a very powerful R data types and functions which help us to analyze and summarize datasets that result from such experiments.</p>
<div class="page-columns page-full"><p>Let us use a real dataset resulting from a randomized controlled trial of testing a drug to be taken against arthritis.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> This dataset is part of the R package <code>multgee</code> (<span class="citation" data-cites="Toul2015">Touloumis A. (<a href="references.html#ref-Toul2015" role="doc-biblioref">2015</a>)</span>). We have added this dataset to our course data library. Let us inspect the first few lines</p><div class="no-row-height column-margin column-container"><li id="fn6"><p><sup>6</sup>&nbsp;The current issue of Wikipedia describes this illness as follows: “Arthritis is a term often used to mean any disorder that affects joints. Symptoms generally include joint pain and stiffness. Other symptoms may include redness, warmth, swelling, and decreased range of motion of the affected joints. In some types of arthritis, other organs are also affected. Onset can be gradual or sudden.”</p></li></div></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(JWL)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(arthritis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id y    sex age     trt baseline    time baselinescore score
1  1 4   male  54    drug        2 Month 1             2     4
2  1 5   male  54    drug        2 Month 3             2     5
3  1 5   male  54    drug        2 Month 5             2     5
4  2 4 female  41 placebo        3 Month 1             3     4
5  2 4 female  41 placebo        3 Month 3             3     4
6  2 4 female  41 placebo        3 Month 5             3     4</code></pre>
</div>
</div>
<p>This dataset contains observations of the self-assessment score of arthritis, an ordered variable with five categories, collected at baseline and three follow-up times during a randomized comparative study of alternative treatments of 302 patients with rheumatoid arthritis. The data came from a randomized clinical trial that aimed to evaluate the effectiveness of the drug Auranofin versus the placebo therapy for the treatment of rheumatoid arthritis. The five-level (1=poor, . . . , 5=very good) ordinal multinomial response variable was the self-assessment of rheumatoid arthritis recorded at one (t = 1), three (t = 2) and five (t = 3) follow-up months.</p>
<section id="the-factor-class" class="level3" data-number="5.6.1">
<h3 data-number="5.6.1" class="anchored" data-anchor-id="the-factor-class"><span class="header-section-number">5.6.1</span> The factor class</h3>
<p>We have already learned that each R object has a class or a type. We have learned about some of these classes like <code>double</code>, <code>integer</code>, <code>chraracter</code>, <code>logical</code> before. Some of the variables in our example dataset have a class we already know: <code>id</code> the identity of individuals who are part of the sample, <code>y</code> the response variable, <code>age</code>, the individual’s age, <code>baseline</code> are all of class or type numeric. We can find out the class of variables using the R function <code>class()</code>. If we type for example</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(arthritis<span class="sc">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
</div>
<p>R answers that this is an integer.</p>
<p>For categorical variables, we discussed in our first unit, R has a special class the <strong>factor-class</strong>. In our dataset the variables <code>sex</code>, <code>trt</code>, <code>baselinescore</code> and <code>score</code> have this class. For example of you type</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|code-fold: false</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(arthritis<span class="sc">$</span>sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
</div>
<p>R answers that this is a factor. R factors are used for categorical variables. The categorical variable in our example is <code>sex</code>. This is the name the data creator chose for this variable. This variable has two categories or levels, which we can find out with the R <code>levels()</code>function by</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(arthritis<span class="sc">$</span>sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "female" "male"  </code></pre>
</div>
</div>
<p>Note that the values of an R factor must be quoted. Either single or double quote marks is fine (though the marks don’t show up when we use head).</p>
<p>Factors can sometimes be a bit tricky to work with, but the above is enough for now. Let’s see how to apply the notion in the current dataset.</p>
<p>We could for instance use the factor structure to compute the mean of the response of the treated male individuals in the sample in Month 1 and the mean response of the non-treated male participants in Month 1:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>whichmt <span class="ot">&lt;-</span> <span class="fu">which</span>(arthritis<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"male"</span> <span class="sc">&amp;</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                 arthritis<span class="sc">$</span>trt <span class="sc">==</span> <span class="st">"drug"</span> <span class="sc">&amp;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                 arthritis<span class="sc">$</span>time <span class="sc">==</span> <span class="st">"Month 1"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>whichmnt <span class="ot">&lt;-</span> <span class="fu">which</span>(arthritis<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"male"</span> <span class="sc">&amp;</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                  arthritis<span class="sc">$</span>trt <span class="sc">==</span> <span class="st">"placebo"</span> <span class="sc">&amp;</span> </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                  arthritis<span class="sc">$</span>time <span class="sc">==</span> <span class="st">"Month 1"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(arthritis[whichmt,<span class="dv">2</span>], <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.294643</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(arthritis[whichmnt,<span class="dv">2</span>], <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.095238</code></pre>
</div>
</div>
<p>Let us unpack this code. The <code>which()</code>function returns the index of entries for which all the conditions imposed on <code>sex</code>, <code>drug</code> and <code>time</code> in the <code>arthritis</code> dataframe are true.</p>
<p>Now, look at the expression <code>arthritis[whichmt,2]</code>. Remember, data frames are accessed with two subscript expressions, one for rows, one for column, in the format</p>
<p><code>d[the rows we want, the columns we want]</code></p>
<p>Thus we select the rows for which all conditions are met and the second column which contains the response variable. Then we take the average of all these observations.</p>
</section>
<section id="the-tapply-function" class="level3" data-number="5.6.2">
<h3 data-number="5.6.2" class="anchored" data-anchor-id="the-tapply-function"><span class="header-section-number">5.6.2</span> The tapply function</h3>
<p>R often offers various different ways to achieve things we want to compute or express. Some of them are stunningly short and elegant. They are also very useful if we have to work with tables like the <code>arthristis</code> dataset. You must therefor learn about the magic <code>tapply()</code>function of R.</p>
<p>Assume we would have the task to produce a so called demographic table from the <code>arthritis</code> data. The table should show:</p>
<ol type="1">
<li><p>How many individuals got the drug and how many got the placebo?</p></li>
<li><p>What is the mean age and the standard deviation of the individuals who got the drug and those who got the placebo?</p></li>
<li><p>What are the numbers of males and females who got the drug or the placebo ?</p></li>
<li><p>What is the distribution of baseline scores between individuals who got the drug and those who got the placebo?</p></li>
</ol>
<p>We saw before how we could arrive at all of these values using the R subsetting rules for dataframes.</p>
<p>But <code>tapply</code>offers you an even more powerful option. Suppose we want to count the cases which were treated and those who got a placebo in Month 1. We first filter the data to only contain the observations for Month 1 and save these values in a new object <code>dat</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> arthritis[arthritis<span class="sc">$</span>time <span class="sc">==</span> <span class="st">"Month 1"</span>, ]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(dat<span class="sc">$</span>y, dat<span class="sc">$</span>trt, length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>placebo    drug 
    149     153 </code></pre>
</div>
</div>
<p>Now comes the magic of the <code>tapply</code>function. The code expressed in words says the following: Group the variable <code>y</code> into the levels of the factor <code>trt</code>. This gives you two groups the group “drug” and the group “placebo”. Now apply the function <code>length()</code>to both groups. This is the same as counting the cases.</p>
<p>What about question 2? Let us apply the same logic here as before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(dat<span class="sc">$</span>age, dat<span class="sc">$</span>trt, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> placebo     drug 
50.70470 50.05882 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(dat<span class="sc">$</span>age, dat<span class="sc">$</span>trt, sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> placebo     drug 
11.23490 11.02583 </code></pre>
</div>
</div>
<p>Here we again apply the same logic. Group the data in <code>dat</code>accroding to the levels of our fatcor <code>trt</code>, i.e.&nbsp;in the group placebo and the group drug and apply to each group the funtion <code>mean()</code> and the function <code>sd</code>.</p>
<p>To make sure it is clear how this works, say for the case of computing the mean, let’s look at a small artificial example, which I have taken from a nice book by <span class="citation" data-cites="Mattloff2023">(<a href="references.html#ref-Mattloff2023" role="doc-biblioref"><strong>Mattloff2023?</strong></a>)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">12</span>,<span class="dv">13</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'M'</span>,<span class="st">"F"</span>,<span class="st">'M'</span>,<span class="st">'M'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Suppose <span class="math inline">\(x\)</span> is the ages of some kids, who are a boy, a girl, then two more boys, as indicated in <span class="math inline">\(g\)</span>. For instance, the 5-year-old is a girl.</p>
<p>Let’s call tapply:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(x,g,mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> F  M 
 5 11 </code></pre>
</div>
</div>
<p>That call said, “Split x into two piles, according to the corresponding elements of g, and then find the mean in each pile.</p>
<p>Note that it is no accident that x and g had the same number of elements above, 4 each. If on the contrary, <span class="math inline">\(g\)</span> had 5 elements, that fifth element would be useless — the gender of a nonexistent fifth child’s age in <span class="math inline">\(x\)</span>. Similarly, it wouldn’t be right if <span class="math inline">\(g\)</span> had had only 3 elements, apparently leaving the fourth child without a specified gender.</p>
<p>Now, let us take another, perhaps slightly more complex example by looking at question 3. Let us begin with the absolute numbers. Now we have two factors according to which we form the groups. Now we do not only group by treatment but also by sex. Then we count the cases in each group. If we have multiple factors, we have to give the grouping argument to apply by the syntax <code>list(factor1, factor2, etc.)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(dat<span class="sc">$</span>y, <span class="fu">list</span>(dat<span class="sc">$</span>sex , dat<span class="sc">$</span>trt), length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       placebo drug
female      43   40
male       106  113</code></pre>
</div>
</div>
<p>Finally, we would answer question 4 by coding</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(dat<span class="sc">$</span>y, <span class="fu">list</span>(dat<span class="sc">$</span>baselinescore, dat<span class="sc">$</span>trt), length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  placebo drug
1      11   12
2      35   38
3      70   69
4      28   28
5       5    6</code></pre>
</div>
</div>
</section>
</section>
<section id="exercises" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="exercises"><span class="header-section-number">5.7</span> Exercises</h2>
<section id="exercises-1" class="level3" data-number="5.7.1">
<h3 data-number="5.7.1" class="anchored" data-anchor-id="exercises-1"><span class="header-section-number">5.7.1</span> Exercises</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 1: The polio vaccine study
</div>
</div>
<div class="callout-body-container callout-body">
<p>Data from the polio vaccine studies discussed in the text suggest that in 1954, the school districts in the NFIP trial and in the randomized controlled experiment had similar exposure to the polio virus. (a) The data also show that children in the two vaccine groups (for the randomized controlled experiment and the NFPI design) came from families with similar incomes and educational backgrounds. Which two numbers in table <a href="#tbl-salk-vaccine-field-trials">Table&nbsp;<span>5.1</span></a> confirm this finding? (b) The data show that children in the two no-consent groups had similar family backgrounds. WHich pair of numbers in the table confirm this finding? (c) The data show that children in the two control groups had different family backgrounds. Which pair of numbers in the table confirm this finding? (d) In the NFIP study, neither the control group nor the no-consent group got the vaccine. Yet the no-consent group had a lower rate of polio. Why? (e) To show that the vaccine works, someone wants to compare the 44/100.000 in the NFPI study with 25/100.000 in the vaccine group. What’s wrong with these data?</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 2: Did the vaccine field trial cause children to get polio?
</div>
</div>
<div class="callout-body-container callout-body">
<p>The polio vaccine studies were conducted only in certain experimental areas (school districts) selected by the Public Health Service in consultation with local officials. In these areas there were about 3 million children in grades 1,2, or 3; and there were about 11 million children in those grades in the United States. In the experimental areas, the incidence of polio was about 25% higher than in the rest of the country. Did the vaccine field trial cause children to get polio instead of preventing it? Answer yes or no and explain briefly.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 3: The effects of smoking on health
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Public Health Service studies the effects of smoking on health, in a large sample of representative households. For men and for women in each age group, those who had never smoked were on average somewhat healthier than the current smokers, but the current smokers were on average much healthier that those who had recently stopped smoking.</p>
<ol type="a">
<li>Why did they study men and women in the different age groups separately?</li>
<li>The lesson seems to be that you shouldn’t start smoking, but once you’ve started don’t stop. Comment briefly.</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 4: Evaluating a prisoners rehabilitation program
</div>
</div>
<div class="callout-body-container callout-body">
<p>A program to rehabilitate prisoners before their release is evaluated. The object of the program is to reduce the recidivism rate - the percentage who will be back in prison within two years of release. The program involves several months of “boot camp” - military-style basic training with very strict discipline. Admission to the program is voluntary. According to a prison spokesman, those who complete the boot camp are less likely to return to prision than other inmates.</p>
<ol type="a">
<li>What is the treatment group in the prison spokesman’s comparison? What is the control group?</li>
<li>Is the prison spokesman’s comparison based on an observational study or a randomized controlled experiment?</li>
<li>True of false: The data show that the bootcamp worked.</li>
</ol>
<p>Explain your answers.</p>
</div>
</div>
</section>
<section id="exercises-r" class="level3" data-number="5.7.2">
<h3 data-number="5.7.2" class="anchored" data-anchor-id="exercises-r"><span class="header-section-number">5.7.2</span> Exercises R</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 5: Practicing the tapply function with the DHS dataset.
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s revisit the children nutrition data <code>children_nutrition_data</code> in the <code>JWL</code>package from the DHS discussed in section 2. Load the <code>JWL</code>package. Earlier in our lecture we analyzed the data using the subsetting rules of the R language. Let us redo some of the analysis now using the <code>tapply()</code>function.</p>
<ol type="1">
<li>Count the number of rows with boys and girls in this dataset by suming the weight variable (<code>wt</code>) for the boys and the girls using the <code>tapply()</code>function.</li>
<li>Compute the prevalence of stunting by region using the <code>tapply()</code> function.</li>
</ol>
</div>
</div>
</section>
</section>
<section id="project-people-count-the-present-and-future-of-humanity-in-pictures-and-numbers" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="project-people-count-the-present-and-future-of-humanity-in-pictures-and-numbers"><span class="header-section-number">5.8</span> Project People count: The present and future of humanity in pictures and numbers</h2>
<section id="age-percentiles-in-kenya-the-united-states-and-japan" class="level3" data-number="5.8.1">
<h3 data-number="5.8.1" class="anchored" data-anchor-id="age-percentiles-in-kenya-the-united-states-and-japan"><span class="header-section-number">5.8.1</span> Age percentiles in Kenya, the United States and Japan</h3>
<p>In the last step of our project, people count, we were trying to compute the mean age for Kenya, the US and Japan. But if we look at the distribution of the number of people across age groups, we see not so much symmetric but rather asymmetric distributions. So let’s continue our analysis here by considering percentiles and look at the median as one percentile, which can be alternatively used to characterize the center of a distribution. Let us also study spreads using the interquartile range.</p>
<p>In order to do so, we can again load the data and make country subsets, as we did last time. Those of you who successfully completed this task last time, can now just recycle the code from the last unit. The others can give it a second trial here. Note the advantage of the notebook. You can now reuse your old code.</p>
<ol type="1">
<li><p>Find the median age group for Kenya, the United states, Japan and for your own country, by constructing a dataframe extended by the cumulative count of people across age groups and the proportion of the cumulative count in the total population.</p></li>
<li><p>Automate this process by writing a R function that takes Country, Year and the entire dataframe <code>dat</code> as argument and returns an approximate median age group.</p></li>
<li><p>Use the approximation procedure for grouped data we used in the last project exercise to compute the mean and standard deviation of the age in the population of your country in 2022. Argue why the age distribution can not be approximated by a normal curve. Reuse the computations you made in the last project step.</p></li>
</ol>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-BanerjeeDuflo2012" class="csl-entry" role="listitem">
Banerjee, Abhijit, and Esther Duflo. 2012. <em>Poor Economics: A Radical Rethinking of the Way to Fight Global Poverty</em>. Public Affairs.
</div>
<div id="ref-Francis1955" class="csl-entry" role="listitem">
Francis, Thomas. 1955. <span>“An Evaluation of the 1954 Poliomyelitis Vaccine Trials - Summary Report.”</span> <em>American Journal of Public Health</em> 45: 1–63.
</div>
<div id="ref-FrePisPur2009" class="csl-entry" role="listitem">
Freedman, David, Robert Pisani, and Roger Purves. 2009. <em>Statistics</em>. Fourth. Viva-Norton.
</div>
<div id="ref-Hedgesetal1994" class="csl-entry" role="listitem">
Larry Hedges, Rob Greenwald, Richard Laine. 1994. <span>“Does Money Matter? A Meta-Analysis of Studies of the Effects of Differential School Inputs on Student Outcomes.”</span> <em>Educational Researcher</em> 3 (23): 5–14.
</div>
<div id="ref-Roser2021" class="csl-entry" role="listitem">
Roser, Max. 2021. <span>“Access to Basic Education: Almost 60 Million Children of Primary School Age Are Not in School.”</span> <a href="https://ourworldindata.org/children-not-in-school">https://ourworldindata.org/children-not-in-school</a>.
</div>
<div id="ref-Spi2019" class="csl-entry" role="listitem">
Spiegelhalter, David. 2019. <em>The Art of Statistcis: Learning from Data</em>. Pelican Books.
</div>
<div id="ref-Toul2015" class="csl-entry" role="listitem">
Touloumis A. 2015. <span>“<span>R</span> Package <span class="nocase">multgee</span>: A Generalized Estimating Equations Solver for Multinomial Responses.”</span> <em>Journal of Statistical Software</em> 64 (8): 1–14. <a href="https://doi.org/10.18637/jss.v064.i08">https://doi.org/10.18637/jss.v064.i08</a>.
</div>
</div>
</section>
</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./from_limited_data_to_populations.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">From limited data to populations</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./modelling_relationships_using_regression_part_1.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modelling relationships: Points, Lines and Scatterplots</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>